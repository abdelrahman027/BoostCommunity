{% extends 'base_custom.html' %}
{% load static %}


{% block style %}
<link rel="stylesheet" href="{% static 'front-end-static/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'front-end-static/css/style.min.css' %}">
{% endblock style %}


{% block title %}
Trainers|Page
{% endblock title %}


{% block content %}



{% include 'parts/navbar.html' %}
<div class="row m-0">
    {% include 'parts/side_nav.html' %}
    <div class="col-9 courses_content mt-4 offset_left" id="side_content">
        <h3 class="text-capitalize my-2">trainers</h3>
        <div class="courses_container shadow p-3 mb-5 bg-body-tertiary rounded">
            <div class="nav justify-content-between" id="nav-tab" role="tablist">
                <div class="d-flex align-items-center">
                    <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home"
                        type="button" role="tab" aria-controls="nav-home" aria-selected="true">All <span
                            class="badge bg-secondary fw-normal">{{trainers.count}}</span></button>
                    <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile"
                        type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Active <span
                            class="badge bg-secondary fw-normal">0</span></button>
                    <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact"
                        type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Not Active <span
                            class="badge bg-secondary fw-normal">{{trainers.count}}</span></button>
                    <!-- LIVE SEARCH TOGGLE -->
                    <img src="{% static 'front-end-static/images/icons/search.svg' %}" id="toggle_search" class="icon"
                        alt="icon" style="cursor: pointer;" onclick="search_toggler()">
                </div>
                <div class="right d-flex">
                    <!-- SORTING TOGGLE -->
                    <button type="button" id="sortBtn" class="btn btn-outline-dark">
                        <img src="{% static 'front-end-static/images/icons/table/sort.svg' %}" class="icon" alt="icon">
                    </button>
                    <!-- FILTER TOGGLE -->
                    <div class="dropdown">
                        <button type="button" class="btn btn-outline-dark" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <img src="{% static 'front-end-static/images/icons/table/filter.svg' %}" class="icon"
                                alt="icon">
                        </button>
                        <ul class="dropdown-menu">
                            <li><button class="dropdown-item" style="border: none;" id="nameFilter">Name</button></li>
                            <li><button class="dropdown-item" style="border: none;" id="priceFilter">Price</button></li>
                            <li><button class="dropdown-item" style="border: none;"
                                    id="locationFilter">Location</button></li>
                        </ul>
                    </div>
                </div>
                <!-- HIDDEN SEARCH INPUT HERE -->
                <input type="hidden" id="nav_Search" class="form-control mt-3" placeholder="Search...">
            </div>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab"
                    tabindex="0">
                    <div class="table_container mt-4 table-responsive">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Sr</th>
                                    <th scope="col">Instructor</th>
                                    <th scope="col">Sector</th>
                                    <th scope="col">Course</th>
                                    <th scope="col">Phone</th>
                                    <th scope="col">Location</th>
                                    <th scope="col">$/h</th>
                                    <th scope="col">Rating</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="trainer__body">
                                {% for trainer in trainers %}

                                <tr class="align-middle">
                                    <th scope="row">{{trainer.TrainerID}}</th>
                                    <td class="text-dark">
                                        <img src="{% static 'front-end-static/images/instructor.jpg' %}"
                                            class="trainer_image" alt="trainer image">
                                        {{trainer.FirstName}} {{trainer.LastName}}
                                    </td>
                                    <td>{{trainer.Qualifications}}</td>
                                    <td>{{trainer.Certificates}}</td>
                                    <td>{{trainer.Phone}}</td>
                                    <td>{{trainer.Location}}</td>
                                    <td class="price">{{trainer.Price}}</td>
                                    <td>
                                        <div
                                            class="default_counter rounded-pill bg-secondary d-flex align-items-center justify-content-center">
                                            <img class="icon m-1"
                                                src="{% static 'front-end-static/images/icons/fox.svg' %}" alt="icon">
                                            <span>14/18</span>
                                        </div>
                                    </td>
                                    <td>
                                        <img src="{% static 'front-end-static/images/icons/dots.svg' %}" alt="icon">
                                    </td>
                                </tr>
                                {% endfor %}


                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab"
                    tabindex="0">...</div>
                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab"
                    tabindex="0">
                    <div class="table_container mt-4 table-responsive">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Sr</th>
                                    <th scope="col">Instructor</th>
                                    <th scope="col">Sector</th>
                                    <th scope="col">Course</th>
                                    <th scope="col">Phone</th>
                                    <th scope="col">Location</th>
                                    <th scope="col">$/h</th>
                                    <th scope="col">Rating</th>
                                    <th scope="col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="trainer__body">
                                {% for trainer in trainers %}

                                <tr class="align-middle">
                                    <th scope="row">{{trainer.TrainerID}}</th>
                                    <td class="text-dark">
                                        <img src="{% static 'front-end-static/images/instructor.jpg' %}"
                                            class="trainer_image" alt="trainer image">
                                        {{trainer.FirstName}} {{trainer.LastName}}
                                    </td>
                                    <td>{{trainer.Qualifications}}</td>
                                    <td>{{trainer.Certificates}}</td>
                                    <td>{{trainer.Phone}}</td>
                                    <td>{{trainer.Location}}</td>
                                    <td class="price">{{trainer.Price}}</td>
                                    <td>
                                        <div
                                            class="default_counter rounded-pill bg-secondary d-flex align-items-center justify-content-center">
                                            <img class="icon m-1"
                                                src="{% static 'front-end-static/images/icons/fox.svg' %}" alt="icon">
                                            <span>14/18</span>
                                        </div>
                                    </td>
                                    <td>
                                        <img src="{% static 'front-end-static/images/icons/dots.svg' %}" alt="icon">
                                    </td>
                                </tr>
                                {% endfor %}


                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JAVASCRIPT LOGIC @@@@@@@ -->
<script>

    let sortAsc = false;
    let trainerName = true;
    let trainerPrice = false;
    let trainerLocation = false;

    const data = '{{trainer_json}}'
    console.log(data)
    // #trainer__body
    //#global_nav_search
    const rdata = JSON.parse(data.replace(/&quot;/g, '"'))
    const nameFilter = document.getElementById('nameFilter');
    const priceFilter = document.getElementById('priceFilter');
    const locationFilter = document.getElementById('locationFilter');
    const local_search = document.getElementById('nav_Search')
    const trainer__body = document.getElementById('trainer__body')
    const sortBtn = document.getElementById('sortBtn')
    console.log(local_search);

    local_search.addEventListener('keyup', (e) =>
    {
        trainer__body.innerHTML = ""
        filteredArr = rdata.filter(trainer => (trainer['FirstName'] + trainer['LastName']).includes(e.target.value))
        console.log(filteredArr);
        if (filteredArr.length > 0) {
            // filteredArr.map((item) =>
            // {
            //     trainer__body.innerHTML += `<tr class="align-middle">
            //                         <th scope="row">${item.TrainerID}</th>
            //                         <td class="text-dark">
            //                             <img src="{% static 'front-end-static/images/instructor.jpg' %}"
            //                                 class="trainer_image" alt="trainer image">
            //                                 ${item.FirstName} ${item.LastName}
            //                         </td>
            //                         <td>${item.Qualifications}</td>
            //                         <td>${item.Certificates}</td>
            //                         <td>${item.Phone}</td>
            //                         <td>${item.Location}</td>
            //                         <td class="price">${item.Price}</td>
            //                         <td>
            //                             <div
            //                                 class="default_counter rounded-pill bg-secondary d-flex align-items-center justify-content-center">
            //                                 <img class="icon m-1"
            //                                     src="{% static 'front-end-static/images/icons/fox.svg' %}" alt="icon">
            //                                 <span>14/18</span>
            //                             </div>
            //                         </td>
            //                         <td>
            //                             <img src="{% static 'front-end-static/images/icons/dots.svg' %}" alt="icon">
            //                         </td>
            //                     </tr>`
            // })
        }
    })
    // filter toggles
    trainerName ? nameFilter.style.color = 'green' : 'black'
    trainerPrice ? priceFilter.style.color = 'green' : 'black'
    trainerLocation ? locationFilter.style.color = 'green' : 'black'
    nameFilter.addEventListener('click', () =>
    {
        nameFilter.style.color = 'green'
        priceFilter.style.color = 'black'
        locationFilter.style.color = 'black'
        trainerName = true
        trainerPrice = false
        trainerLocation = false
    })
    priceFilter.addEventListener('click', () =>
    {
        nameFilter.style.color = 'black'
        priceFilter.style.color = 'green'
        locationFilter.style.color = 'black'
        trainerName = false
        trainerPrice = true
        trainerLocation = false
    })
    locationFilter.addEventListener('click', () =>
    {
        nameFilter.style.color = 'black'
        priceFilter.style.color = 'black'
        locationFilter.style.color = 'green'
        trainerName = false
        trainerPrice = false
        trainerLocation = true
    })



    //sort filter
    sortBtn.addEventListener('click', () =>
    {
        trainer__body.innerHTML = ""
        sortAsc = !sortAsc
        //name conditions
        if (sortAsc && trainerName) {

            rdataSorted = rdata.sort((a, b) => a.FirstName.toLowerCase().localeCompare(b.FirstName.toLowerCase())
            );
        } else if (!sortAsc && trainerName) {

            rdataSorted = rdata.sort((a, b) => b.FirstName.toLowerCase().localeCompare(a.FirstName.toLowerCase()));
        }
        //price conditions

        else if (sortAsc && trainerPrice) {

            rdataSorted = rdata.sort((a, b) => b.Price - a.Price);
        } else if (!sortAsc && trainerPrice) {

            rdataSorted = rdata.sort((a, b) => a.Price - b.Price);
        }
        //location condition
        if (sortAsc && trainerLocation) {
            rdataSorted = rdata.sort((a, b) => b.Location - a.Location);
        } else if (!sortAsc && trainerLocation) {
            rdataSorted = rdata.sort((a, b) => a.Location - b.Location);

        }

        rdataSorted.map((item) =>
        {
            trainer__body.innerHTML += `<tr class="align-middle">
                                    <th scope="row">${item.TrainerID}</th>
                                    <td class="text-dark">
                                        <img src="{% static 'front-end-static/images/instructor.jpg' %}"
                                            class="trainer_image" alt="trainer image">
                                            ${item.FirstName.capitalize()} ${item.LastName.capitalize()}
                                    </td>
                                    <td>${item.Qualifications}</td>
                                    <td>${item.Certificates}</td>
                                    <td>${item.Phone}</td>
                                    <td>${item.Location}</td>
                                    <td class="price">${item.Price}</td>
                                    <td>
                                        <div
                                            class="default_counter rounded-pill bg-secondary d-flex align-items-center justify-content-center">
                                            <img class="icon m-1"
                                                src="{% static 'front-end-static/images/icons/fox.svg' %}" alt="icon">
                                            <span>14/18</span>
                                        </div>
                                    </td>
                                    <td>
                                        <img src="{% static 'front-end-static/images/icons/dots.svg' %}" alt="icon">
                                    </td>
                                </tr>`
        })
        console.log(rdataSorted);
    })
    //end sort filter

    const toggle_search = document.getElementById('toggle_search')
    const search_toggler = () =>
    {
        if (local_search.type == 'hidden') {
            local_search.type = 'text'
        } else {
            local_search.type = 'hidden'
        }
    };

</script>

{% endblock content %}